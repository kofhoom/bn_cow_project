<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/_css/common.css">
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>

<body>
    <div id="div-header"></div>
    <div class="wrap password__change">
        <!-- 상세 타이틀 시작 -->
        <div class="common__info-title-wrap">
            <h1 class="common__info-title">
                마이페이지
            </h1>
        </div>
        <!-- 상세 타이틀 끝 -->
        <!-- 상세 페이지 맵 리스트 시작-->
        <div class="common__page-map-wrap">
            <ul>
                <li class="common__map-list">회원정보 수정</li>
                <li class="common__map-list">&middot;</li>
                <li class="common__map-list">내가 쓴 글 보기</li>
                <li class="common__map-list">&middot;</li>
                <li class="common__map-list">스크랩</li>
                <li class="common__map-list">&middot;</li>
                <li class="common__map-list">회원탈퇴</li>
            </ul>
        </div>
        <!-- 상세 페이지 맵 리스트 끝-->
        <!-- 상세 컨텐츠 시작 -->
        <section class="common__content mt40">
            <div class="form__wrap">
                <!-- 폼 영역 시작 -->
                <form class="common__form password_check" action="/subpage/member/private_join_check.php"
                    enctype="multipart/form-data" method="post" name="join_form" id="join_form">
                    <fieldset>
                        <p class="common__form-title">비밀번호 변경</p>
                        <div class="common__fieldset-inner">
                            <!-- 비밀번호 영역 시작-->
                            <div class="common-input__wrap">
                                <!-- 라벨 영역 시작 -->
                                <div class="common-box__label">
                                    <label>
                                        <span class="important__star">*</span>현재 비밀번호
                                    </label>
                                </div>
                                <!-- 라벨 영역 끝 -->
                                <!-- 인풋 영역 시작 -->
                                <div class="common-box__input">
                                    <div class="input__inner">
                                        <input type="text" id="user_password" name="user_password"
                                            autocomplete="new-password" />
                                        <!-- <span class="validation__message"></span> -->
                                    </div>
                                    <span class="input-error__message user_password"></span>
                                </div>
                                <!-- 인풋 영역 끝 -->
                            </div>
                            <!-- 비밀번호 영역 끝-->
                            <hr>

                            <!-- 비밀번호 영역 시작-->
                            <div class="common-input__wrap">
                                <!-- 라벨 영역 시작 -->
                                <div class="common-box__label">
                                    <label>
                                        <span class="important__star">*</span>새 비밀번호
                                    </label>
                                </div>
                                <!-- 라벨 영역 끝 -->
                                <!-- 인풋 영역 시작 -->
                                <div class="common-box__input">
                                    <div class="input__inner">
                                        <input type="password" id="password" name="password" autocomplete="new-password"
                                            oninput="passWordCheck(this.value)" />
                                        <!-- <span class="validation__message"></span> -->
                                    </div>
                                    <span class="input-error__message password">*특수문자, 숫자, 영문 모두 포함 8자리 이상</span>
                                </div>
                                <!-- 인풋 영역 끝 -->
                            </div>
                            <!-- 비밀번호 영역 끝-->
                            <!-- 비밀번호 확인 영역 시작-->
                            <div class="common-input__wrap">
                                <!-- 라벨 영역 시작 -->
                                <div class="common-box__label">
                                    <label>
                                        <span class="important__star">*</span>비밀번호 확인
                                    </label>
                                </div>
                                <!-- 라벨 영역 끝 -->
                                <!-- 인풋 영역 시작 -->
                                <div class="common-box__input">
                                    <div class="input__inner">
                                        <input type="password" id="password_check" name="password_check"
                                            autocomplete="new-password"
                                            onkeyup="passWordRecheck(this.value,'password',1)" />
                                        <!-- <span class="validation__message"></span> -->
                                    </div>
                                    <span class="input-error__message password_check"></span>
                                </div>
                                <!-- 인풋 영역 끝 -->
                            </div>
                            <!-- 비밀번호 확인 영역 끝-->
                            <button class="common__btn-small mauto mb40-important"
                                onclick="form_submit('password-change');">수정</button>

                            <hr>
                                    <!-- 상세 타이틀 시작 -->
                                    <p class="common__form-title">비밀번호 질문/답 변경</p>

        <!-- 상세 타이틀 끝 -->
                            <!-- 비밀번호 찾기 질문 영역 시작-->
                            <div class="common-input__wrap">
                                <div class="common-box__label">
                                    <!-- 라벨 영역 시작 -->
                                    <label>
                                        <span class="important__star">*</span>비밀번호 찾기 질문
                                    </label>
                                    <!-- 라벨 영역 끝 -->
                                </div>
                                <!-- 인풋 영역 시작 -->
                                <div class="common-box__input">
                                    <div class="input__inner">
                                        <select name="password_answer_check" id="password_answer_check"
                                            style="max-width:36rem;">
                                            <option value="d">질문선택</option>
                                            <option value="test">테스트</option>
                                        </select>
                                    </div>
                                    <span class="input-error__message password_answer_check"></span>
                                </div>
                                <!-- 인풋 영역 끝 -->
                            </div>
                            <!-- 비밀번호 찾기 답 영역 시작-->
                            <div class="common-input__wrap">
                                <div class="common-box__label">
                                    <!-- 라벨 영역 시작 -->
                                    <label>
                                        <span class="important__star">*</span>비밀번호 찾기 답
                                    </label>
                                    <!-- 라벨 영역 끝 -->
                                </div>
                                <!-- 인풋 영역 시작 -->
                                <div class="common-box__input">
                                    <div class="input__inner">
                                        <input type="text" id="password_answer_check_result"
                                            name="password_answer_check_result" />
                                    </div>
                                    <span class="input-error__message password_answer_check_result"></span>
                                </div>
                                <!-- 인풋 영역 끝 -->
                            </div>
                            <!-- 비밀번호 찾기 답 영역 끝-->
                            <button class="common__btn-small mauto"
                                onclick="form_submit('password-answer-change');">수정</button>
                        </div>
                    </fieldset>




                </form>
                <!-- 폼 영역 끝 -->
            </div>
        </section>
        <!-- 상세 컨텐츠 끝 -->
    </div>

    <div id="div-footer"></div>

    <script defer>
        async function load() {
            let jsComponent = await import("/_js/fetch.js");
            jsComponent.headerLayout();
            jsComponent.footerLayout();
        }
        load();
    </script>
    <script>
        /*******************************************************************
    // 설명 : 전역 변수
    ********************************************************************/
        let passwordState = false; //일반 비밀번호 유효성
        let passwordCheck = false; //일반 비밀번호 일치 확인

        /*******************************************************************
        // 설명 : 공통정의 함수
        ********************************************************************/

        /**
         * 비밀번호 유효성 오류 텍스트
         * @param {DomClass} targetClass
         * @param {String} message 에러 메시지
         */

        const errorText = (targetClass, message) =>
            (document.querySelector(`.${targetClass}`).innerHTML = message);


        /**
         * 인풋 벨류 초기화 함수
         * @param {String} errorTextDomName valueReset로 부터 전달받은 메개변수
         */
        const eventBindValue = (errorTextDomName) => {
            const elTargets = document.querySelector(`.${errorTextDomName}`)
            if (event.target.value.length > 0) {
                elTargets.innerHTML = "";
                return
            }
            elTargets.innerHTML = "";
        }

        /**
         * 벨류 초기화 공통 함수
         * @param {String} targetName 초기화될 해당 에러 문구 이름
         */
        const valueReset = (targetName, radioTarget) => {
            inputs = document.getElementById(targetName) || document.getElementsByName(targetName)[0];
            switch (inputs.type) {
                case 'text':
                    inputs.setAttribute("onkeyup", "eventBindValue('" + targetName + "')");
                    break;
                case 'radio':
                    let radioArrays = document.querySelectorAll(`.${radioTarget}`);
                    for (i = 0; i < radioArrays.length; i++) {
                        radioArrays[i].addEventListener("click", () => {
                            if (event.target.value == "on") {
                                eventBindValue(targetName)
                            }
                        });
                    }
                    break;
                case 'select-one':
                    inputs.addEventListener('change', () => {
                        if (event.target.value !== 'd') {
                            eventBindValue(targetName)
                        }
                    })
            }
        };

        /**
         * 종합 문자열 유효성 체크
         * @param {String} str input에 value
         * @param {String} type 해당 문자의 타입
         * @returns {Boolean}
         */
        const strCheck = (str, type) => {
            let REGEX = {
                EMAIL: /^[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_\.]?[0-9a-zA-Z])*\.[a-zA-Z]{2,3}$/i,
                ID_RULE: /^[a-z0-9_-]{5,15}$/,
                PWD_RULE: /^(?=.*[a-zA-Z])((?=.*\d)(?=.*\W)).{8,16}$/,
                NAME_RULE: /^[가-힣a-zA-Z]+$/,
            };

            if (type === "email") return REGEX.EMAIL.test(str);
            else if (type === "id") return REGEX.ID_RULE.test(str);
            else if (type === "pwd") return REGEX.PWD_RULE.test(str);
            else if (type === "name") return REGEX.NAME_RULE.test(str);
            else return false;
        }

        // 폼 submit 함수
        function form_submit(type) {
            let form = document.join_form;
            let flag = true; // submit 기능 활성화 or 비활성화 상태 설정

            event.preventDefault();

            if (type == 'password-change') {
                // 현재 비밀번호
                if (!form.user_password.value) {
                    alert("현재 비밀번호를 입력해주세요.");
                    errorText("user_password", "현재 비밀번호를 입력해주세요.");
                    form.user_password.focus();
                    valueReset("user_password");

                    return false;
                }
                // 비밀번호
                if (!form.password.value) {
                    alert("새 비밀번호를 입력해주세요.");
                    errorText("password", "새 비밀번호를 입력해주세요.");
                    form.password.focus();
                    valueReset("password");

                    return false;
                }

                // 비밀번호 확인
                if (!form.password_check.value) {
                    alert("비밀번호 확인을 입력해주세요.");
                    errorText("password_check", "비밀번호 확인을 입력해주세요.");
                    form.password_check.focus();
                    valueReset("password_check");

                    return false;
                }

                // 비밀번호 유효성 여부
                if (!passwordState) {
                    alert("비밀번호 유효성을 확인해주세요.");
                    errorText("password", "비밀번호 유효성을 확인해주세요.");
                    form.password.focus();


                    return false;
                }
                // 비밀번호 일치 여부
                if (!passwordCheck) {
                    alert("비밀번호가 일치하지 않습니다.");
                    errorText("password_check", "비밀번호가 일치하지 않습니다");
                    form.password_check.focus();

                    return false;
                }
            } else if (type == 'password-answer-change') {
                // 비밀번호 찾기 질문
                if (form.password_answer_check.value == 'd') {
                    alert("비밀번호 찾기 질문을 선택해주세요.");
                    errorText("password_answer_check", "비밀번호 찾기 질문을 선택해주세요");
                    form.password_answer_check.focus();
                    valueReset("password_answer_check");

                    return false;
                }
                // 비밀번호 찾기 답
                if (!form.password_answer_check_result.value) {
                    alert("비밀번호 찾기 답을 입력해 주세요");
                    errorText("password_answer_check_result", "비밀번호 찾기 답을 입력해 주세요");
                    form.password_answer_check_result.focus();
                    valueReset("password_answer_check_result");

                    return false;
                }
            }

            if (flag == true) {
                console.log(
                    "수정이 완료되었습니다.\n" +
                    `
          비밀번호: ${form.password.value}\n
          비밀번호확인: ${form.password_check.value}\n
          비밀번호찾기질문: ${form.password_answer_check.value}\n
          비밀번호찾기답: ${form.password_answer_check_result.value}\n
          `
                );

                form.submit();

            }
        }

        // 비밀번호 유효성
        function passWordCheck(values) {
            let passWordErrorText = document.querySelector(".input-error__message.password");
            let passVal = values;

            if (values.length > 0)
                passWordErrorText.innerHTML = "";

            if (!passVal) {
                passWordErrorText.innerHTML = "*특수문자, 숫자, 영문자 포함 8자리 이상";
                passWordErrorText.style.color = "gray";

                return (passwordState = false);
            } else {
                if (!strCheck(passVal, "pwd")) {
                    passWordErrorText.innerHTML = "*특수문자, 숫자, 영문자 포함 8자리 이상";
                    passWordErrorText.style.color = "red";

                    return (passwordState = false);
                } else {
                    passWordErrorText.innerHTML = "사용가능한 비밀번호입니다.";
                    passWordErrorText.style.color = "blue";

                    return (passwordState = true);
                }
            }
        }

        // 비밀번호 확인
        function passWordRecheck(values, targetId, idx) {
            const mainPassWord = document.getElementById(`${targetId}`).value;
            const passWordErrorText = document.querySelector(".input-error__message.password_check");

            if (values.length > 0) {
                passWordErrorText.innerHTML = "";
            }

            if (!values) passWordErrorText.innerHTML = "";
            else if (values == mainPassWord) {
                passWordErrorText.classList.remove("error");
                passWordErrorText.innerHTML = "비밀번호가 일치합니다.";
                passWordErrorText.style.color = "blue";

                return (passwordCheck = true);
            } else {
                passWordErrorText.classList.add("error");
                passWordErrorText.innerHTML = "비밀번호가 일치하지 않습니다.";
                passWordErrorText.style.color = "red";

                return (passwordCheck = false);
            }
        }

        const toggleAgree = document.querySelectorAll('.common__form-content');
        toggleAgree.forEach(el => {
            el.addEventListener('click', () => {
                el.classList.toggle('active')
            })
        })
    </script>
</body>

</html>